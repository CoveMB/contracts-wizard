FROM rust:latest

WORKDIR /usr/src/stellar-api

RUN apt-get update && apt-get install -y \
    gdb lldb build-essential pkg-config libssl-dev curl \
    && rm -rf /var/lib/apt/lists/*

RUN rustup update stable \
    && rustup default stable \
    && rustup component add --toolchain stable rustfmt clippy

COPY Cargo.toml Cargo.lock ./
RUN cargo fetch
COPY . .

RUN cargo install cargo-watch

EXPOSE 8888

CMD ["cargo", "watch", "-x", "run"]